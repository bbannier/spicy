# @TEST-EXEC: spicyc -dj %INPUT -o foo.hlto -T >>output 2>&1
# @TEST-EXEC: ${SCRIPTS}/printf 'FF\x01\x02' | spicy-driver foo.hlto >>output 2>&1
# @TEST-EXEC: btest-diff output

module foo;

public type X = unit {
    : bytes &size=2; # FF
    : Y;
};

type Y = unit {
    payload: bytes &eod { print $$, offsets(self); }
    xyz: uint8[2] &parse-from=self.payload foreach {
        print $$, offsets(self);
    }
    {
        print $$, offsets(self);
    }
};

function offsets(x: Y): string {
    return "offset=%s input=%s position=%s" % (x.offset(), x.input(), x.position());
}

# FIXME(bbannier): also check with limited via, e.g., `&max-size`/`&size` on subunit.
